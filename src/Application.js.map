{"version":3,"file":"Application.js","sourceRoot":"","sources":["Application.ts"],"names":[],"mappings":"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","sourcesContent":["import {Emoji} from \"./Image/Emoji.js\"\r\nimport {Seconds} from \"./Domain.js\"\r\nimport {AnimatedImage} from \"./Image/AnimatedImage.js\"\r\nimport {Option} from \"./Utils/Option.js\"\r\nimport {Utils} from \"./Utils/Utils.js\"\r\nimport {EmojiSizeWarning} from \"./EmojiSizeWarning.js\"\r\nimport {EmojiGeneratorList} from \"./EmojiGenerator/EmojiGeneratorList.js\"\r\n\r\n\r\nexport interface ImageOptions {\r\n  image: AnimatedImage,\r\n  name: string\r\n}\r\n\r\nexport interface ExpandTimelineOptions {\r\n  length: Seconds,\r\n  fps: number\r\n}\r\n\r\nexport interface Options {\r\n  sourceImage: Option<ImageOptions>\r\n  width: number\r\n  height: number\r\n  expandTimeline: Option<ExpandTimelineOptions>\r\n  SmoothRotation: boolean,\r\n  animationReverse: boolean,\r\n  flipHorizontal: boolean,\r\n  flipVertical: boolean\r\n}\r\n\r\n\r\nexport class Application {\r\n  emojis: Emoji[] = []\r\n  options: Options = {\r\n    width: 64,\r\n    height: 64,\r\n    sourceImage: Option.none(),\r\n    expandTimeline: Option.none(),\r\n    SmoothRotation: true,\r\n    animationReverse: false,\r\n    flipHorizontal: false,\r\n    flipVertical: false\r\n  }\r\n  emojiSizeWarning: EmojiSizeWarning\r\n  emojiGeneratorList: EmojiGeneratorList\r\n\r\n  constructor(\r\n    private emojiNameInput: HTMLInputElement,\r\n    private fileInput: HTMLInputElement,\r\n    private smileSizeInput: HTMLInputElement,\r\n    private compressionInput: HTMLInputElement,\r\n    private forceAnimateInput: HTMLInputElement,\r\n    private animationLengthInput: HTMLInputElement,\r\n    private fpsInput: HTMLInputElement,\r\n    private imagePreview: HTMLImageElement,\r\n    private downloadButton: HTMLButtonElement,\r\n    private smoothRotationInput: HTMLInputElement,\r\n    private animationReverseInput: HTMLInputElement,\r\n    private flipHorizontalInput: HTMLInputElement,\r\n    private flipVerticalInput: HTMLInputElement,\r\n  ) {\r\n    this.reloadOptions()\r\n    this.emojiSizeWarning = new EmojiSizeWarning()\r\n    this.emojiSizeWarning.updateRoot(document.body)\r\n  }\r\n\r\n  inputChange() {\r\n    this.reloadOptions()\r\n    this.redraw()\r\n  }\r\n\r\n  initializeEvents() {\r\n    this.emojiNameInput.onchange = () => this.reloadOptions()\r\n    this.smileSizeInput.onchange = () => this.inputChange()\r\n    this.compressionInput.onchange = () => this.inputChange()\r\n    this.animationReverseInput.onchange = () => this.inputChange()\r\n    this.flipHorizontalInput.onchange = () => this.inputChange()\r\n    this.flipVerticalInput.onchange = () => this.inputChange()\r\n    this.animationLengthInput.onchange = () => this.inputChange()\r\n    this.fpsInput.onchange = () => this.inputChange()\r\n    this.smoothRotationInput.onchange = () => this.inputChange()\r\n    this.forceAnimateInput.onchange = () => {\r\n      if (this.forceAnimateInput.checked) {\r\n        this.animationLengthInput.disabled = false\r\n        this.fpsInput.disabled = false\r\n      } else {\r\n        this.animationLengthInput.disabled = true\r\n        this.fpsInput.disabled = true\r\n      }\r\n\r\n      this.inputChange()\r\n    }\r\n    this.fileInput.onchange = (event: any) => {\r\n\r\n      const fileList = event.target.files\r\n      const file: File = fileList.item(0)\r\n      const reader = new FileReader()\r\n      if (file) {\r\n        this.imagePreview.src = \"resources/loading.gif\"\r\n        reader.onloadend = () => this.onFileSelection(file, reader.result as ArrayBuffer)\r\n        setTimeout(() => reader.readAsArrayBuffer(file), 10)\r\n      }\r\n    }\r\n\r\n    this.downloadButton.onclick = () => this.downloadRenderedEmojis()\r\n  }\r\n\r\n  syncGifs() {\r\n    // noinspection SillyAssignmentJS\r\n    this.emojis.forEach(emoji => emoji.imageElement.forEach(imgElement => imgElement.src = imgElement.src))\r\n  }\r\n\r\n  reloadOptions() {\r\n    const oldOptions = this.options\r\n    const size = Number(this.smileSizeInput.value)\r\n    let expandTimelineOptions = Option.none<ExpandTimelineOptions>()\r\n    if (this.forceAnimateInput.checked)\r\n      expandTimelineOptions = Option.some(\r\n        {\r\n          length: Number(this.animationLengthInput.value),\r\n          fps: Number(this.fpsInput.value)\r\n        }\r\n      )\r\n    const newEmojiName = this.emojiNameInput.value\r\n    this.options = {\r\n      sourceImage: oldOptions.sourceImage.map(options => {\r\n        options.name = newEmojiName\r\n        return options\r\n      }),\r\n      width: size,\r\n      height: size,\r\n      expandTimeline: expandTimelineOptions,\r\n      SmoothRotation: this.smoothRotationInput.checked,\r\n      animationReverse: this.animationReverseInput.checked,\r\n      flipHorizontal: this.flipHorizontalInput.checked,\r\n      flipVertical: this.flipVerticalInput.checked\r\n    }\r\n    this.emojiGeneratorList = new EmojiGeneratorList(\r\n      this.options.SmoothRotation,\r\n      this.options.animationReverse,\r\n      this.options.flipHorizontal,\r\n      this.options.flipVertical\r\n    )\r\n    this.emojis.forEach(emoji => emoji.generator = this.emojiGeneratorList.getGenerator(emoji.generator.namePrefix))\r\n  }\r\n\r\n  redraw() {\r\n    this.emojis.forEach(emoji => {\r\n      if (this.options.sourceImage.nonEmpty()) {\r\n        emoji.imageElement.map(element => element.src = \"resources/loading.gif\")\r\n        emoji.render(this.options).then(isSuccessfully => {\r\n          if (isSuccessfully) {\r\n            emoji.checkSize()\r\n            emoji.updateAttachedImageElement()\r\n            this.syncGifs()\r\n            setTimeout(() => {\r\n              this.syncGifs()// иногда не синхронизируются сгенеренные эмодзи\r\n            }, 100)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  onFileSelection(file: File, data: ArrayBuffer) {\r\n    const fileName = file.name.split(\".\")\r\n    const fileExtension = fileName.pop()\r\n\r\n    AnimatedImage.fromImage(data, fileExtension).then(image => {\r\n      this.imagePreview.src = Utils.arrayBufferToUrl(data, fileExtension)\r\n      this.emojiNameInput.value = fileName[0].substr(0, 96)\r\n      this.emojiNameInput.disabled = false\r\n      this.options.sourceImage = Option.some({\r\n        name: fileName[0],\r\n        image: image.right\r\n      })\r\n      this.redraw()\r\n    })\r\n  }\r\n\r\n  generateEmojiTable(map: (string | null)[][]): HTMLTableElement {\r\n    const table = document.createElement(\"table\")\r\n    table.className = \"emojiTable\"\r\n    const emojis: Emoji[] = []\r\n    map.forEach(row => {\r\n      const rowElement = document.createElement(\"tr\")\r\n      row.forEach(emojiRendererName => {\r\n        const emojiElement = document.createElement(\"img\")\r\n        emojiElement.src = \"resources/transparent.png\"\r\n        emojiElement.className = \"emoji\"\r\n        if (emojiRendererName == null) {\r\n        } else {\r\n          const newEmoji = new Emoji(this.emojiGeneratorList.getGenerator(emojiRendererName), this.emojiSizeWarning)\r\n          emojiElement.setAttribute(\"renderer\", emojiRendererName)\r\n          newEmoji.attach(emojiElement)\r\n          emojis.push(newEmoji)\r\n        }\r\n        rowElement.append(emojiElement)\r\n      })\r\n      table.append(rowElement)\r\n    })\r\n\r\n    this.emojis = emojis\r\n    return table\r\n  }\r\n\r\n  downloadBlobAsFile(blob: Blob, filename: string) {\r\n    const fakeMouseEvent = document.createEvent('MouseEvents')\r\n    const fakeElement = document.createElement('a')\r\n\r\n    fakeElement.download = filename\r\n    fakeElement.href = window.URL.createObjectURL(blob)\r\n    fakeElement.dataset.downloadurl = [blob.type, fakeElement.download, fakeElement.href].join(':')\r\n    fakeMouseEvent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null)\r\n    fakeElement.dispatchEvent(fakeMouseEvent)\r\n  }\r\n\r\n  downloadRenderedEmojis() {\r\n    let time = 0\r\n    this.emojis.forEach(emoji => {\r\n      time += .2\r\n      emoji.renderedGif.forEach(gifBlob =>\r\n        this.options.sourceImage.forEach(imageOptions => {\r\n          setTimeout(() => this.downloadBlobAsFile(gifBlob, imageOptions.name + \"_\" + emoji.generator.namePrefix), time * 1000)\r\n        })\r\n      )\r\n    })\r\n  }\r\n}"]}