{"version":3,"file":"FrameGenerator.js","sourceRoot":"","sources":["FrameGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["import {RelativeFabricImage} from \"../Image/RelativeImage/RelativeFabricImage.js\"\r\nimport {fabric} from \"../Vendor.js\"\r\nimport {KeyValuePair} from \"../Domain\"\r\n\r\nexport type FrameGenerator = (image: RelativeFabricImage, timeNormalized: number) => Promise<RelativeFabricImage[]>\r\n\r\nexport const LinearGenerator: FrameGenerator =\r\n  async (image, time) => {\r\n    const clone = await image.copy()\r\n\r\n    image.setPos(time + 0.5, 0.5)\r\n    clone.setPos((time - 1) + 0.5, 0.5)\r\n    return [image, clone]\r\n  }\r\n\r\nexport const RotationGenerator: FrameGenerator =\r\n  async (image, time) => {\r\n    image.setPos(.5, .5)\r\n    image.set({\r\n      originX: \"center\",\r\n      originY: \"center\",\r\n      angle: 360 * time\r\n    })\r\n    return [image]\r\n  }\r\n\r\nexport const TurnGenerator: FrameGenerator =\r\n  async (image, time) => {\r\n    const copy0 = await image.copy()\r\n    const copy = await image.copy()\r\n\r\n    if (time <= 0.5)\r\n      copy0.setPos(time - 0.5, 0.5)\r\n    else {\r\n      copy0.setPos(0, 1)\r\n      copy0.set({\r\n        originX: \"center\",\r\n        originY: \"bottom\",\r\n        angle: 90 * (time - 0.5)\r\n      })\r\n    }\r\n\r\n    if (time >= 0.5) {\r\n      copy.set({\r\n        angle: 90\r\n      })\r\n      copy.setPos(0.5, time + 0.5)\r\n    } else {\r\n      copy.setPos(0, 1)\r\n      copy.set({\r\n        originX: \"center\",\r\n        originY: \"bottom\",\r\n        angle: 90 * (time + 0.5)\r\n      })\r\n    }\r\n\r\n    return [copy0, copy]\r\n  }\r\n\r\nconst linesN = 20\r\nexport const TurnGeneratorFlex: FrameGenerator =\r\n  async (image, time) => {\r\n    function createSlices(copies: Array<KeyValuePair<number, RelativeFabricImage>>, time: number) {\r\n      // time = time - 0.002\r\n      const sliceWidth = image.underlying.width / linesN\r\n      return copies.map(pair => {\r\n        const index = pair.key\r\n        const copy = pair.value\r\n        copy.set({\r\n          originX: index / (linesN),\r\n          angle: 90 * (time + index / (linesN))\r\n        })\r\n        copy.setPos(0, 1)\r\n\r\n        copy.underlying.clipPath = new fabric.Rect({\r\n          width: Math.floor(sliceWidth * 3),\r\n          height: copy.underlying.height,\r\n          top: -copy.underlying.height / 2,\r\n          left: sliceWidth * index - copy.underlying.width / 2 - sliceWidth / 3 * 2\r\n        })\r\n        return copy\r\n      })\r\n    }\r\n\r\n    image.setPos(0, 1)\r\n    image.set({\r\n      originX: 0,\r\n      originY: \"bottom\",\r\n      angle: 90 * time\r\n    })\r\n    const copies1 = await image.copyN(linesN)\r\n    const copies2 = await image.copyN(linesN)\r\n\r\n\r\n    const layers1 = createSlices(copies1, time - 1)\r\n    const layers2 = createSlices(copies2, time)\r\n\r\n    return [...layers1, ...layers2]\r\n  }\r\n\r\nexport function Reverse(underlying: FrameGenerator): FrameGenerator {\r\n  return async (image: RelativeFabricImage, timeNormalized: number) => {\r\n    const newImage = await image.copy()\r\n\r\n    return await underlying(newImage, 1 - timeNormalized)\r\n  }\r\n}\r\n\r\nexport const Shake: FrameGenerator =\r\n  async (image, _) => {\r\n    image.setPos(0.5 + (Math.random() - 0.5) / 10, 0.5 + (Math.random() - 0.5) / 10)\r\n    image.set({\r\n      angle: 10 * (Math.random() - 0.5)\r\n    })\r\n    return [image]\r\n  }"]}